<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="js/netfunnel.js" charset="UTF-8"></script>
	<script type="text/javascript" src="js/test_skin.js" charset="UTF-8"></script>

	<script>

		function goAction(aid){
			var dp = document.getElementById("debug_print");
			var frm = document.ftest;

			//Netfunnel 자원 사용 요청
			NetFunnel_Action({action_id:aid,use_mobile_ui:"true", skin_id:"default"},{
				success:function(ev,ret){
				//실제 제어하고자 했던 Business Logic을 호출하시면 됩니다.
					var msg = "success:"
						+",code="+ret.code
						+",key="+ret.data.key
						+",ip="+ret.data.ip
						+",port="+ret.data.port
						+",nnext="+ret.data.nnext
						+",nwait="+ret.data.nwait
						+",tps="+ret.data.tps
						+",ttl="+ret.data.ttl;
					dp.innerHTML += "<br>"+msg;
				},
				continued:function(ev,ret){
				//대기 상황에서 반복 호출되는 callback으로 필수는 아니며, 필요시 활성화해서 사용하시면 되겠습니다.
					var msg = "continued:"
						+",code="+ret.code
						+",key="+ret.data.key
						+",ip="+ret.data.ip
						+",port="+ret.data.port
						+",nnext="+ret.data.nnext
						+",nwait="+ret.data.nwait
						+",tps="+ret.data.tps
						+",ttl="+ret.data.ttl;
					dp.innerHTML += "<br>"+msg;
				},
				stop:function(ev,ret){
				//중지 버튼을 눌렀을 때 호출되는 callback으로 별도 처리하지 않을 경우, 대기창(div)가 hidden 및 destory 처리합니다.
				//중지 버튼을 눌렀을 때 별도 처리가 필요한 경우 사용하시면 되겠습니다.
					var msg = "stopped";
					dp.innerHTML += "<br>"+msg;
				},
				error:function(ev,ret){
				//넷퍼넬 장애로 인해 서비스에 영향을 미치면 안되기에, default로 error도 success와 동일하게 동작하도록 구성되어 있습니다.
				//따라서, error 상황일 때 별도 처리가 필요한 경우(특정 error page로 redirect 또는 별도 logging 처리 등)를 제외하고
				//error callback을 사용하지 않으시거나(미사용 시 success처리), success와 동일하게 구성하시길 권고드립니다.
					var msg = "error:"
							+",code="+ret.code
							+",msg="+ret.data.msg;
					dp.innerHTML += "<br>"+msg;
				},
				bypass:function(ev,ret){
				//넷퍼넬 관리자페이지에서 해당 액션ID를 우회(bypass)처리했을 때 호출되는 callback으로 별도 처리가 필요한 경우 사용하실 수 있습니다.
					var msg = "bypass:"
						+",code="+ret.code
						+",key="+ret.data.key
						+",ip="+ret.data.ip
						+",port="+ret.data.port
						+",nnext="+ret.data.nnext
						+",nwait="+ret.data.nwait
						+",tps="+ret.data.tps
						+",ttl="+ret.data.ttl;
					dp.innerHTML += "<br>"+msg;
				},
				block:function(ev,ret){
				//넷퍼넬 관리자페이지에서 해당 액션ID를 차단(block)처리했을 때 호출되는 callback으로 별도 처리가 필요한 경우 사용하실 수 있습니다.
				// ex) 10:00부터 서비스가 시작됩니다.   모든 상품이 소진되었습니다. 등에 활용
					var msg = "block:"
						+",code="+ret.code
						+",key="+ret.data.key
						+",ip="+ret.data.ip
						+",port="+ret.data.port
						+",nnext="+ret.data.nnext
						+",nwait="+ret.data.nwait
						+",tps="+ret.data.tps
						+",ttl="+ret.data.ttl;
					dp.innerHTML += "<br>"+msg;
					NetFunnel.PopupSetup("alert", ret, "blockSkin");
					return false;
				},
				ipblock:function(ev,ret){
				//넷퍼넬 관리자페이지에서 액세스제어 기능을 활성화하고, 액세스제어 정책에 해당될 경우에만 호출되는 callback으로 
				//비정상적인 접근을 차단할 때 사용할 수 있습니다.
					var msg = "ipblock:"
							+",code="+ret.code
							+",msg="+ret.data.msg;
					dp.innerHTML += "<br>"+msg;
					NetFunnel.PopupSetup("alert", ret, "ipBlockSkin");
					return false;
				},
				expressnumber:function(ev,ret){
				//넷퍼넬 관리자페이지에서 액세스제어 기능을 활성화하고, express 항목에 등록된 IP/ID에 해당될 경우에만 호출되는 callback으로 
				//bypass 처리되며, 별도 처리가 필요할 경우 사용하실 수 있습니다.
					var msg = "express_number:"
						+",code="+ret.code
						+",key="+ret.data.key
						+",ip="+ret.data.ip
						+",port="+ret.data.port
						+",nnext="+ret.data.nnext
						+",nwait="+ret.data.nwait
						+",tps="+ret.data.tps
						+",ttl="+ret.data.ttl;
					dp.innerHTML += "<br>"+msg;
				}
			});
		}

		//Netfunnel form submit 적용
		function formSubmit(){
			var frm = document.ftest;
			NetFunnel_Action({},frm);
			//frm.submit();
		}

		//Netfunnel Skin TEST
		function testSkin(skinid){
			var msg = "커스텀 대기창("+skinid+")";
			var dp = document.getElementById("debug_print");
			var frm = document.ftest;
			NetFunnel_Action({action_id:'load', skin_id:skinid},function(ev,ret){dp.innerHTML += "<br>"+msg; console.log(msg);});
			//frm.submit();
		}

		//Netfunnel default Skin
		function defaultSkin(){
			var msg = "default 대기창";
			var dp = document.getElementById("debug_print");
			var frm = document.ftest;

			/*	skin_id 미지정
						case 1. skin_id 미지정하고, 별도의 skin.js를 include 한 경우 - <script type="text/javascript" src="js/test_skin.js" charset="UTF-8">
								: test_skin.js 파일의 가장 마지막에 정의된 skin 대기창 적용
						case 2. skin_id 미지정하고, 별도의 skin.js를 include 하지 않은 경우
							    : netfunnel.js 내 default 대기창 적용
				*/
			NetFunnel_Action({action_id:'load', skin_id:"default"},function(ev,ret){dp.innerHTML += "<br>"+msg; console.log(msg);});
			//frm.submit();
		}


		function goComplete(){
			var dp = document.getElementById("debug_print");
			var frm = document.ftest;

			//Netfunnel 명시적 완료처리
			NetFunnel_Complete( {},function(ev,ret){ dp.innerHTML += "<br> complete:"+ret.code+", msg="+ret.data.msg; } );
		}

		function goClear(){
			var dp = document.getElementById("debug_print");
			dp.innerHTML = "";
		}

		function goAliveNotice(){
			NetFunnel_Action({action_id:"alivenotice"},function(ev,ret){
				location.href="alivenotice/1page.html";
			});

		}
		function gokeycheck(){
				location.href="keycheck/keypage.html";
		}



	</script>
</head>
<body>
	<h1>NetFUNNEL2 JS Test</h1>
	<form action="main.html" method="post" id="ftest" name="ftest">
		<input type="button" value="1. index_click" onclick="goAction('index');">
		<input type="button" value="2. debug_click" onclick="goAction('debug');">
		<input type="button" value="3. bypass_click" onclick="goAction('bypass');">
		<input type="button" value="4. block_click" onclick="goAction('block');">
		<input type="button" value="5. load_click" onclick="goAction('load');">
		<input type="button" value="6. Complete" onclick="goComplete();">


		<input type="button" value="Clear" onclick="goClear()">
		<br><br>
		<input type="button" value="커스텀 대기창skin1" onclick="testSkin('skin1');">
		<input type="button" value="커스텀 대기창skin2" onclick="testSkin('skin2');">
		<input type="button" value="커스텀 대기창skin3" onclick="testSkin('skin3');">
		<input type="button" value="default" onclick="defaultSkin();">

		<br><br>
		<!-- link에 Netfunnel 적용하는 예 -->
		<a href="AutoCompleteTrue.html" onclick="NetFunnel_Action({},'AutoCompleteTrue.html');return false;">auto complete(true) 링크적용 </a>
		<br>
		<a href="AutoCompleteFalse.html" onclick="NetFunnel_Action({},'AutoCompleteFalse.html');return false;">auto complete(false) 링크적용 </a>


		<br><br>
		ID: <input type="text" name="memberID" id="memberID" value="ID" readonly="readonly"><br>
		비밀번호: <input type="password" name="memberPW" id="memberPW" value="PW" readonly="readonly">
		<br><br>
		<input type="button"  onclick="formSubmit()" value="로그인">
		<br><br>
		<input type="button" value="Alivenotice" onclick="goAliveNotice();">
		<br><br>
		<input type="button" value="keycheck관련정보" onclick="gokeycheck();">

		<div id="debug_print" style="width:100%;height:800px;overflow:hidden;font-size:10px">
		</div>

	</form>
	</body>
	</html>
